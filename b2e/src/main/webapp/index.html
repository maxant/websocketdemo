<html>
<head>
    <title>Websocket Demo</title>

  <script>

  var socket, socket;
  if (window.WebSocket) {
    setupWebSocket();
  } else {
    alert("Your browser does not support Websockets.");
  }

  function send(message) {
    if (!window.WebSocket) {
      return false;
    }
    if (socket.readyState == WebSocket.OPEN) {
      socket.send(message);
    } else {
      alert("The socket is not open.");
    }
    return false;
  }

  function setupWebSocket(){
    console.log("reconnecting ws...");
    socket = new WebSocket("ws://localhost:8082/b2e");
    socket.onmessage = function(event) {
      var chat = document.getElementById('chat');
      chat.innerHTML = chat.innerHTML + event.data + "<br />";
    };
    socket.onerror = function(event) {
      console.log("error with WS: " + JSON.stringify(event));
      var error = document.getElementById('error');
      error.innerHTML = error.innerHTML + event.data + "<br />";
    };
    socket.onopen = function(event) {
      console.log("reconnected ws. " + JSON.stringify(event));
    };
    socket.onclose = function(event){
      console.log("ws closed. retrying in 100ms. " + JSON.stringify(event));
      setTimeout(setupWebSocket, 100);
    };
  }

  </script>

  <style type="text/css">

    .center {
      margin-left: auto;
      margin-right: auto;
      width: 70%;
      background: white;
    }

    .chatform {
      margin-left: auto;
      margin-right: auto;
      margin-bottom: 0;
      width: 70%;
    }

    form {
      width: 100%;
    }

    label {
      display: inline;
      width: 100px;
    }

    #msg {
      display: inline;
      width: 100%;
    }

  </style>
</head>
<body>
<div class="page">
    <div class="center">
        <h1>Some Site</h1>

        <div id="error" style="height:30px; background: red;"></div>
        <div id="chat" style="height:100%;width: 100%; overflow: scroll;"></div>

        <form onsubmit="return false;" class="chatform" action="">
            <label for="msg">Message</label>
            <input type="text" name="message" id="msg"
                   onkeypress="if(event.keyCode==13) { send(this.form.message.value); this.value='' } "/>
        </form>
    </div>
</div>
</body>
</html>